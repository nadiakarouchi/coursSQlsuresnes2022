<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <!-- MES STYLES -->
    <link rel="stylesheet" href="../coursSQL/css/style.css">
    <title>Cours SQL/ Requêtes </title>

    <!-- Mon code JS est ici placé dans l'en-tête, dans l'élément head de mon fichier, à l'intérieur de la balise script. Ce code récupère l'heure et l'actualise toutes les secondes et nous permet de l'afficher ou de la masquer via un bouton -->
    <!-- JS !!!  ; ouvrez toujours l'inspecteur de votre navigateur et sa console pour avoir les informations sur les scripts -->

</head>

<body>
    <!-- navigation navbar  -->

    <nav class="navbar navbar-light  fixed-top p-2">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">SQL</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar"
                aria-controls="offcanvasNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar"
                aria-labelledby="offcanvasNavbarLabel">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Index</h5>
                    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"
                        aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                    <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="offcanvasNavbarDropdown" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">
                                Introduction
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="offcanvasNavbarDropdown">
                                <li><a class="dropdown-item" href="#introduction">Introduction</a></li>
                                <li><a class="dropdown-item" href="#modelisation">Modélisation d'une BDD</a></li>
                                <li><a class="dropdown-item" href="#table">Les tables</a></li>
                                <li><a class="dropdown-item" href="#colonne">Les colonnes ou les champs</a></li>
                                <li><a class="dropdown-item" href="#donnees">Les types de données</a></li>
                                <li><a class="dropdown-item" href="#pk">Type de données PK AI pour les ID</a></li>
                                <li><a class="dropdown-item" href="#cardinalite">Les cardinalités</a></li>
                                <li><a class="dropdown-item" href="#jointure">Table de jointure</a></li>
                                <li><a class="dropdown-item" href="#fk">Clefs étrangères ou Fk</a></li>
                                <li><a class="dropdown-item" href="#enregristrement">Les enregistrements</a></li>
                                <li><a class="dropdown-item" href="#bdd">Interroger la BDD</a></li>

                            </ul>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../coursSQLsuresnes2022/01_requetes.html">01/Requetes</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../coursSQlsuresnes2022/">02/Requetes</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../coursSQLsuresnes2022/03_requetes_imbriquees.html">03/Requetes
                                imbriquées</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="../coursSQLsuresnes2022/04_jointure.html">04/Jointure</a>
                        </li>

                    </ul>
                    <form class="d-flex">
                        <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                        <button class="btn btn-outline-success" type="submit">Search</button>
                    </form>
                </div>
            </div>
        </div>
    </nav>
    <!-- fin nav -->
    <div id="carouselExampleSlidesOnly" class="carousel slide container-fluid" data-bs-ride="carousel">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="img/pma.jpg" class="d-block w-75 img-fluid text-center" alt="sql">
            </div>
            <div class="carousel-item">
                <img src="img/sql.jpg" class="d-block w-75 img-fluid text-center" alt="sqlmediaa">
            </div>
            <div class="carousel-item">
                <img src="img/php.jpg" class="d-block w-75 img-fluid text-center" alt="php">
            </div>
        </div>
    </div>
    <!-- fin carousel -->

    <!-- =================================== -->
    <!-- en-tête de la page -->
    <!-- =================================== -->
    <header class="container-fluid ">
        <div class="row">
            <h1 class="display-1 text-center alert alert-danger">Cours SQL - requetes imbriquées - page
                03</h1>
        </div>
    </header>
    <!-- =================================== -->
    <!-- conteneur principal-->
    <!-- =================================== -->
    <section class="container mb-4 bg-light">
        <div class="row m-2">
            <div class="col-sm-12">
                <h1 class="text-center alert-primary alert">Les requêtes imbriquées MySQL</h1>
            </div>
        </div> <!-- fin de la première row -->

        <div class="row m-2 border p-2">
            <div class="col-sm-12">
                <h2 class="text-center alert-info" id="insertInto">1 - Création de la BDD bibliotheque</h2>
            </div>
            <div class="col-sm-12 col-md-4">
                <h3 class="text-center alert-warning alert">a) La modélisation</h3>
                <p>Création de la table abonne en SQL: </p>
                <ul>
                    <li class="alert-warning">pour créer la table abonne on a besoin lignes de commande suivants :</li>
                    <code class="alert-success">
                          CREATE TABLE IF NOT EXISTS abonne ( <br>
                            id_abonne INT(3) NOT NULL AUTO_INCREMENT,<br>
                            prenom VARCHAR(20) NOT NULL,<br>
                            PRIMARY KEY (id_abonne) <br>
                            )ENGINE=innoDB;<br>
                        </code>
                </ul>
            </div>
            <div class="col-sm-12 col-md-8">
                <figure>
                    <img src="img/abonne.png" alt="" class="img-fluid">
                </figure>
            </div>
            <div class="col-6">
                <figure>
                    <img src="img/livre.png" alt="" class="img-fluid">
                </figure>
            </div>
            <div class="col-6">
                <li class="alert-warning"> Création de la deuxième table, celle des livres :</li>
                <code class="alert-success"> CREATE TABLE IF NOT EXISTS livre (
                        id_livre INT(3) NOT NULL AUTO_INCREMENT,
                        auteur VARCHAR(30) NOT NULL,
                        titre VARCHAR(30) NOT NULL,
                        PRIMARY KEY (id_livre)
                        )ENGINE=innoDB;</code>
            </div>

            <div class="col-6 border">
                <figure class="text-center mx-auto">
                    <img src="img/emprunt.png" alt="" class="img-fluid">
                </figure>
            </div>
            <div class="col-6">
                <li class="alert-warning">Création de la dernière table, celle des emprunts :</li>
                <code
                    class="alert-success">CREATE TABLE IF NOT EXISTS emprunt ( id_emprunt INT(3) NOT NULL AUTO_INCREMENT, id_livre INT(3) DEFAULT NULL, id_abonne INT(3) DEFAULT NULL, date_sortie DATE NOT NULL, date_rendu DATE DEFAULT NULL, PRIMARY KEY (id_emprunt) )ENGINE=innoDB;</code>
            </div>
            <div class=" col-6 border">
                <figure class="text-center mx-auto">
                    <img src="img/designer.png" alt="" class="img-fluid">
                </figure>
                <p class="alert alert-danger">Pour vérifier la construction de nos tables, on utilise
                    <code>DESCRIBE emprunt;</code>
            </div>
            <div class="col-6 border">
                <li class="alert-warning">Création des clefs étrangères </li><br>
                <code class="alert-success">ALTER TABLE emprunt ADD FOREIGN KEY (id_livre) REFERENCES bibliotheque.livre(id_livre); <br>
            ALTER TABLE emprunt ADD FOREIGN KEY (id_abonne) REFERENCES bibliotheque.abonne (id_abonne);</code></p>
               
            </div>
            <div class="col-6 border">
                <li class="alert-warning">pour inserer les donnée dans la table livre</li>
                <code class="alert-success">INSERT INTO livre (id_livre, auteur, titre) VALUES <br>
                    (100, 'GUY DE MAUPASSANT', 'Une vie'), <br>
                    (101, 'GUY DE MAUPASSANT', 'Bel-Ami '),<br>
                    (102, 'HONORE DE BALZAC', 'Le père Goriot'),<br>
                    (103, 'ALPHONSE DAUDET', 'Le Petit chose'),<br>
                    (104, 'ALEXANDRE DUMAS', 'La Reine Margot'),<br>
                    (105, 'ALEXANDRE DUMAS', 'Les Trois Mousquetaires')</code><br>
            </div>
            <div class="col-6 border">
                <li class="alert-warning">données dans la table emprunt</li>
                <code class="alert-success">INSERT INTO emprunt (id_emprunt, id_livre, id_abonne, date_sortie, <br>date_rendu) VALUES<br>
                        (1, 100, 1, '2014-12-17', '2014-12-18'),<br>
                        (2, 101, 2, '2014-12-18', '2014-12-20'),<br>
                        (3, 100, 3, '2014-12-19', '2014-12-22'),<br>
                        (4, 103, 4, '2014-12-19', '2014-12-22'),<br>
                        (6, 105, 2, '2015-03-20', '2015-03-26'),<br>
                        (7, 105, 3, '2015-06-13', NULL),<br>
                        (8, 100, 2, '2015-06-15', NULL)</code><br>

            </div>
        </div>
        <div class="row m-2 border p-2">
            <div class="col-sm-12">
                <h2 class="text-center alert-info" id="insertInto">2-SELECT sur plusieurs tables</h2>
            </div>
            <div class="col-12 border alert alert-success">
                <ul>
                    <li><code>SELECT * FROM abonne;</code></li>
                    <li><code>SELECT * FROM Livre;</code></li>
                    <li><code>SELECT * FROM emprunt;</code></li>
                </ul>
            </div>
            <!-- fin col  -->
            <div class="col-12 border">
                <ul>
                    <li>On cherche les livres qui n'ont pas encore été rendu :
                        <code>SELECT id_livre FROM emprunt WHERE date_rendu IS NULL;</code>
                    </li>
                    <hr>
                    <li class="alert alert-danger">Pour trouver quelque chose qui est NULL on utilisera le terme IS !
                    </li>
                    <li>On cherche les titres des livres qui n'ont pas été rendu :
                        <code>SELECT titre FROM livre WHERE id_livre IN (SELECT id_livre FROM emprunt WHERE date_rendu IS NULL);</code>
                        le champ id_livre est utilisé pour relier le sinfos de la table livre et de la table emprunt.
                    </li>
                    <hr>
                    <li class="alert alert-danger">On utilise le mot clé IN et non pas le signe (=) car plusieurs
                        résultats seront renvoyés par la requête. </li>
                        <hr>
                    <li>On cherche maintenant l'id de livre que Chloe a emprunté :
                        <code>SELECT id_livre FROM emprunt WHERE id_abonne = 3;</code>
                    </li>
                    <hr>
                    <li>On cherche maintenantle prénom des abonnés ayant emprunté un livre le 2014-12-19 :
                        <code>SELECT prenom FROM abonne WHERE id_abonne IN (SELECT id_abonne FROM emprunt WHERE date_sortie ='2014-12-19');</code>
                    </li>
                    <hr>
                    <li>Afficher la liste des abonnées ayant emprunté un livre de ALPHONSE Daudet :
                        <code>SELECT prenom FROM abonne WHERE id_abonne IN(SELECT id_abonne FROM emprunt WHERE id_livre IN (SELECT id_livre FROM livre WHERE auteur = 'alphonse daudet'));</code>
                        ou bien par 3 requêtes
                        <code>select id_livre from livre where auteur = 'alphonse daudet'; <br>
                            SELECT id_abonne FROM emprunt WHERE id_livre = '103'; <br>
                            SELECT prenom FROM abonne WHERE id_abonne = '4'; <br></code>
                    </li>
                    <hr>
                    <li>Afficher les titres d elivre que CHloé a emprunté à la bibliothèque :
                        <code>SELECT titre FROM livre WHERE id_livre IN (SELECT id_livre FROM emprunt WHERE id_abonne IN (SELECT id_abonne FROM abonne WHERE prenom='chloe'));</code> <br>
                        ou bien étape par étape <br>
                        <code>SELECT id_abonne FROM abonne WHERE prenom = 'chloé'; <br>
                            SELECT id_livre FROM emprunt WHERE id_abonne =(SELECT id_abonne FROM abonne WHERE prenom = 'chloé'); <br>
                            SELECT titre FROM livre WHERE id_livre IN(SELECT id_livre FROM emprunt WHERE id_abonne =(SELECT id_abonne FROM abonne WHERE prenom = 'chloé');)</code>
                    </li>
                    <hr>
                    <li>Afficher les titres des livres que Chloe n'a pas emprunté :
                        <code>SELECT titre FROM livre WHERE id_livre NOT IN (SELECT id_livre FROM emprunt WHERE id_abonne IN (SELECT id_abonne FROM abonne WHERE prenom='chloe'));</code> <br>
                        ou bien on met avec <code>=</code> <br>
                        <code>SELECT titre FROM livre WHERE id_livre NOT IN (SELECT id_livre FROM emprunt WHERE id_abonne = (SELECT id_abonne FROM abonne WHERE prenom='chloe'));</code>
                    </li>
                    <hr>
                    <li>Afficher les titres de slivres que Chloé n'a pas encore rendu à la bibliothèque :
                        <code>SELECT titre FROM livre WHERE id_livre IN (SELECT id_livre FROM emprunt WHERE date_rendu IS NULL AND id_abonne IN (SELECT id_abonne FROM abonne WHERE prenom='chloe'));</code>
                    </li>
                    <hr>
                    <li>Combien de livres Guillaume a emprunté à la bibliothèque ? :
                        <code>SELECT COUNT(id_livre) FROM emprunt WHERE id_abonne IN(SELECT id_abonne FROM abonne WHERE prenom='Guillaume');</code><br>
                        OU <br>
                        <code>SELECT COUNT(*) AS 'nombre de livres' FROM emprunt WHERE id_abonne IN(SELECT id_abonne FROM abonne WHERE prenom='Guillaume');</code>
                    </li>
                </ul>

            </div>
        </div>
    </section>
    <!-- fin container  -->
    <!-- Optional JavaScript -->
    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
        crossorigin="anonymous"></script>
</body>

</html>